<script type="module">
  import { IfcViewerAPI } from "https://cdn.jsdelivr.net/npm/web-ifc-viewer@1.0.218/dist/ifc-viewer-api.js";

  const container = document.getElementById("viewer-container");

  // 注意这里带 wasmPath
  const viewer = new IfcViewerAPI({
    container,
    backgroundColor: new Uint8Array([255, 255, 255]),
    wasmPath: "https://cdn.jsdelivr.net/npm/web-ifc@0.0.47/"
  });

  viewer.axes.setAxes();
  viewer.grid.setGrid();

  let gridVisible = true;

  const IFC_URL =
    "https://raw.githubusercontent.com/Hongyu-Jiang/Hackthon_SamrtTUM/main/ifc/TU%20Geb%C3%A4ude%203_2019.ifc";

  async function loadIFC() {
    try {
      const model = await viewer.IFC.loadIfcUrl(IFC_URL);
      console.log("IFC loaded:", model);
    } catch (e) {
      console.error("Failed to load IFC:", e);
    }
  }

  loadIFC();

  // 这几行一定要保留，挂到 window 上
  window.resetView = () => {
    viewer.IFC.context.ifcCamera.cameraControls.reset(true);
  };

  window.toggleGrid = () => {
    gridVisible = !gridVisible;
    viewer.grid.visible = gridVisible;
  };

  window.goFullScreen = () => {
    if (container.requestFullscreen) container.requestFullscreen();
  };
</script>
