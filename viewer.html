<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>xeokit IFC Viewer</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
      }
      #myCanvas {
        width: 100%;
        height: 100%;
        display: block;
      }
    </style>
  </head>
  <body>
    <canvas id="myCanvas"></canvas>

    <!-- 使用 ES module + CDN 的方式引入 xeokit 和 web-ifc -->
    <script type="module">
      // 从 jsDelivr 导入 xeokit SDK
      import {
        Viewer,
        WebIFCLoaderPlugin,
      } from "https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk@2.6.27/dist/xeokit-sdk.es.js";

      // 导入 web-ifc
      import * as WebIFC from "https://cdn.jsdelivr.net/npm/web-ifc@0.0.51/web-ifc-api.js";

      window.onload = async () => {
        // 1. 创建 Viewer
        const viewer = new Viewer({
          canvasId: "myCanvas",
          transparent: true,
        });

        // 相机大概摆一个合适位置，后面会自动飞到模型上
        viewer.camera.eye = [-20, 20, 20];
        viewer.camera.look = [0, 0, 0];
        viewer.camera.up = [0, 1, 0];

        // 2. 初始化 web-ifc
        const IfcAPI = new WebIFC.IfcAPI();
        // wasm 放在 CDN 上，不用你本地配置
        IfcAPI.SetWasmPath("https://cdn.jsdelivr.net/npm/web-ifc@0.0.51/");
        await IfcAPI.Init();

        // 3. 创建 WebIFCLoaderPlugin
        const ifcLoader = new WebIFCLoaderPlugin(viewer, {
          WebIFC,
          IfcAPI,
        });

        // 4. 加载 IFC（注意这里的路径）
        const model = ifcLoader.load({
          id: "TU_TUM_Model",
          // 你的 IFC 文件：位于仓库下的 ifc/TU_Gebaeude_3_2019.ifc
          src: "./ifc/TU_Gebaeude_3_2019.ifc",
          edges: true, // 显示边线，可关掉
        });

        // 模型加载完成后，镜头飞过去
        model.on("loaded", () => {
          const aabb = viewer.scene.getAABB(model.id);
          viewer.cameraFlight.flyTo(aabb, {
            duration: 1.0,
          });
        });
      };
    </script>
  </body>
</html>
